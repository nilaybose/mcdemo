pipeline {
    agent any
    stages {
    	stage('INT_ENV') {
            steps {
                sh 'echo $PWD'
                sh '/Users/nbose/jenkins/init.sh'
            }
        }
        stage('Build') {
            steps {
                sh './gradlew build'
            }
        }
        stage('Docker') {
            steps {
            	withEnv(["PATH=$PATH"]){
	            	docker.build "nilaybose/mkubedemo:latest"      	
	            	sh '/usr/local/bin/docker login -u nilaybose -p ${DOCKER_PWD} https://index.docker.io/v1/'
	            	sh '/usr/local/bin/docker push nilaybose/mkubedemo:latest'
	           	}
           }
        }
        stage('Deploy V1') {
            steps {
                sh '/usr/local/bin/kubectl create -f ./v1_deploy.yaml --record'
            }
        }
    }
}


