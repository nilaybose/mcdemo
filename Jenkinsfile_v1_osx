pipeline {
    agent any
    environment {
        DOCKER_HUB  = credentials('docker_hub')
        BIN = '/usr/local/bin'
   	}
    stages {  	
        stage('Build') {
            steps {
                sh './gradlew build'
            }
        }
        stage('Docker'){
            steps{
            	sh '$BIN/docker build -t nilaybose/mkubedemo:latest .'           	
            	sh '$BIN/docker login -u $DOCKER_HUB_USR -p $DOCKER_HUB_PSW https://index.docker.io/v1/'
            	sh '$BIN/docker push nilaybose/mkubedemo:latest'           	
           }
        }
        stage('Deploy V1') {
            steps {
                sh '$BIN/kubectl create -f ./v1_deploy.yaml --record'
            }
        }
    }
}


